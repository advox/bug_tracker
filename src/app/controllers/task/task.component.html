<navigation></navigation>
<div class="container-fluid">
    <h1 class="page-header">Tasks</h1>

    <div class="form-group">
        <button class="btn btn-default" (click)="setFilter('status', 1); getTasks();" title="Get tasks to do">
            To do
        </button>
        <button class="btn btn-success" (click)="setFilter('status', 2); getTasks();" title="Get completed tasks">
            <i class="fa fa-check"></i> Done
        </button>
    </div>

    <p-paginator rows="{{filters.perPage}}" totalRecords="{{totalItems}}" [rowsPerPageOptions]="[25,50,100]"
                 (onPageChange)="getTasks($event);"></p-paginator>

    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>Title</th>
                <th>Status</th>
                <th>Rank</th>
                <th>Importance</th>
                <th>SEB</th>
                <th>Brief</th>
                <th>From</th>
                <th>Posts</th>
                <th>Created</th>
                <th>Updated</th>
            </tr>
            </thead>
            <tbody>
            <ng-container *ngIf="tasks.length">
                <tr *ngFor="let task of tasks">
                    <td>{{task.title}}</td>
                    <td>
                        <span *ngIf="!task.showStatusChange" (click)="task.showStatusChange = !task.showStatusChange;">
                            {{task.status}}
                        </span>
                        <span *ngIf="task.showStatusChange">
                            <div class="input-group">
                                <select class="form-control" [(ngModel)]="task.status">
                                    <option *ngFor="let status of taskStatuses" value="{{status._id}}">
                                        {{status.name}}
                                    </option>
                                </select>
                                <span class="input-group-btn">
                                    <button class="btn btn-success btn-xs"
                                            (click)="updateTask({status : task.status}, task._id)">
                                        <i class="fa fa-save"></i>
                                    </button>
                                </span>
                            </div>
                        </span>
                    </td>
                    <td>{{task.rank}}</td>
                    <td>{{task.important}}</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>{{task.createdAt | date: 'yyyy-MM-dd hh:mm'}}</td>
                    <td>{{task.updatedAt | date: 'yyyy-MM-dd hh:mm'}}</td>
                </tr>
            </ng-container>
            <ng-container *ngIf="tasks.length === 0">
                <tr>
                    <td colspan="99" class="text-center">No tasks</td>
                </tr>
            </ng-container>
            </tbody>
        </table>
    </div>
    <p-paginator rows="{{filters.perPage}}" totalRecords="{{totalItems}}" [rowsPerPageOptions]="[25,50,100]"
                 (onPageChange)="getTasks($event);"></p-paginator>
</div>
